#!/bin/bash
if [[ $EUID -ne 0 ]]; then
   echo "Este script deve ser execuado como root." 
   exit 1
fi
IFS=$(echo -en "\n\b")
if [[ "$(mount | grep '/dev/sda2 on / type btrfs')" == *"subvol=/ROOT)"* ]];then 
    for i in $(yadm -Y /etc/yadm stun /etc/X11/* \
    /etc/systemd/* \
    /etc/systemd/* \
    /etc/sysctl.d/* \
    /etc/modprobe.d/* \
    /etc/tmpfiles.d/* \
    /etc/modules-load.d/* \
    /usr/local/bin/* --porcelain); do
        if [ -n "$(echo "$i" | grep '??')" ];then
            yadm -Y /etc/yadmm add "/$(echo "$i" | cut -d '"' -f2 | cut -c3-99 | tr -d ' ')";
        fi
    done
    yadm -Y /etc/yadm status --porcelain
    read
    yadm -Y /etc/yadm commit -a -m "atualizando"
else
    echo -e "Você não está no subvolume ROOT. push não realizado"
fi
