#!/bin/bash
if [[ $EUID -ne 0 ]]; then
   echo "This script must be run as root" 
   exit 1
fi

if [[ "$(mount | grep '/dev/sda2 on / type btrfs')" == *"subvol=/ROOT)"* ]];then 
    if [ -n "$(yadm -Y /etc/yadm diff --name-only)" ]; then
        yadm -Y /etc/yadm diff
    elif  [ -n "$(yadm status -Y /etc/yadm --porcelain | grep "^A" | cut -c 4-)" ]; then
        if [ $(yadm status -Y /etc/yadm --porcelain | grep "^A" | cut -c 4- | wc -l) -ge 2 ]; then
            echo -e "ARQUIVOS ADICIONADOS:\n/$(yadm status -Y /etc/yadm --porcelain | grep "^A" | cut -c 4-)\n"
        else
            echo -e "ARQUIVO ADICIONADO:\n/$(yadm status -Y /etc/yadm --porcelain | grep "^A" | cut -c 4-)\n"
        fi
        echo 'NENHUM ARQUIVO MODIFICADO'
        exit 1
    fi
    if [ $(yadm -Y /etc/yadm diff --name-only | wc -l) -ge 2 ]; then
         echo -e "\nARQUIVOS MODIFICADOS:\n/$(yadm -Y /etc/yadm diff --name-only)\n"
    else
        echo -e "\nARQUIVO MODIFICADO:\n/$(yadm -Y /etc/yadm diff --name-only)\n"
    fi

#     yadm -Y /etc/yadm commit -a -m "atualizando"
    echo "atyulaizado"
else
    echo -e "Você não está no subvolume ROOT. push não realizado"
fi
